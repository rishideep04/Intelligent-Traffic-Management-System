pipeline {
    agent any

    environment {
        PYTHON = '"C:\\Users\\M AKASH REDDY\\AppData\\Local\\Programs\\Python\\Python312\\python.exe"'
        APP_DIR = 'train4\\train4\\weights' // points to your app directory
    }

    stages {
        stage('Clone Repository') {
            steps {
                git credentialsId: 'github-credentials', url: 'https://github.com/rishideep04/Intelligent-Traffic-Management-System.git'
            }
        }

        stage('Setup Environment') {
            steps {
                bat """
                %PYTHON% -m venv venv
                call venv\\Scripts\\activate
                pip install -r train4\\train4\\weights\\requirements.txt
                pip install -r train4\\train4\\weights\\templates\\requirements.txt
                """
            }
        }

        stage('Run Tests') {
            steps {
                bat """
                call venv\\Scripts\\activate
                cd train4\\train4\\weights
                cd train4\\train4\\weights\\templates
                python -m unittest discover
                """
            }
        }

        stage('Start Flask App') {
            steps {
                bat """
                call venv\\Scripts\\activate
                cd train4\\train4\\weights
                python app2.py
                """
            }
        }
    }

    post {
        failure {
            echo 'Pipeline failed!'
        }
    }
}
